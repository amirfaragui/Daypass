
@(Html.Kendo().Grid<ValueCards.Models.ConsumerModel>()
      .Name("grid")
      .Columns(columns =>
      {
        columns.Bound(model => model.Id).Visible(false);
        columns.Bound(model => model.CardNumber).Width(80);
        columns.Bound(model => model.FirstName).Width(120);
        columns.Bound(model => model.Surname).Width(120);
        columns.Bound(model => model.Balance).Width(100).Format("{0:C}");
        columns.Bound(model => model.ValidUntil).Width(150);

        columns.Command(command =>
        {
          command.Custom("Topup").Text("Edit").Click("onTopUp");
          
        }).Width(80);

        columns.Command(command =>
       {
             command.Custom("History").Text("History").Click("onTopUp");

       }).Width(200);

      })
  .ToolBar(t => t.Search())
  .Pageable(p =>
  {
    p.Refresh(true);
    p.PageSizes(new int[] { 50, 100, 200, 500 });
  })
  .Scrollable(scrollable => scrollable.Enabled(true).Height("calc(100vh - 230px)").Virtual(true))
  .Selectable(selectable => selectable.Mode(GridSelectionMode.Single))
  .DataSource(datasource => datasource
    .Ajax()
    .Model(model =>
    {
      model.Id(o => o.Id);
    })
    .Read(read => read.Action("read", "consumers"))
    .PageSize(50)
  )
  .Resizable(resize => resize.Columns(true))
  .Sortable()
  .Search(search =>
  {
    search.Field(i => i.CardNumber).Field(i => i.FirstName).Field(i => i.Surname);
  })
)

@section Scripts{ 
  <script type="text/javascript">
      function onTopUp(e) {
      e.preventDefault();

      var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
      var url = '@Url.Action("topup", "consumers")/' + dataItem.Id;
      newTab = window.open(url, '_blank');
    }
  </script>
}
