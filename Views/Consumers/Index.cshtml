@(Html.Kendo().Grid<ValueCards.Models.DayPassModel>()
      .Name("grid")
      .Events(e => e.DataBound("onDataBound"))
      .Columns(columns =>
      {
        columns.Bound(model => model.Id).Visible(false);
        columns.Bound(model => model.CEPAN).Width(160);
        columns.Bound(model => model.StartDate).Width(120).Title("Start Validity");
        columns.Bound(model => model.EndDate).Width(120).Title("End Validity");
        columns.Bound(model => model.NumberofDaysPurchased).Width(100);
        columns.Bound(model => model.NumberofDaysRemaining).Width(150);

        columns.Command(command =>
        {
          command.Custom("Topup").Text("Edit").Click("onTopUp");
          command.Custom("History").Text("History").Click("onPassHistory");
          
        }).Width(120).Title("Action");

    

      })
  .ToolBar(t => t.Search())
  .Pageable(p =>
  {
    p.Refresh(true);
    p.PageSizes(new int[] { 50, 100, 200, 500 });
  })
  .Scrollable(scrollable => scrollable.Enabled(true).Height("calc(100vh - 230px)").Virtual(true))
  .Selectable(selectable => selectable.Mode(GridSelectionMode.Single))
  .DataSource(datasource => datasource
    .Ajax()
    .Model(model =>
    {
      model.Id(o => o.Id);
    })
    .Read(read => read.Action("read", "consumers"))
    .PageSize(50)
  )
  .Resizable(resize => resize.Columns(true))
  .Sortable()
  .Search(search =>
  {
      search.Field(i => i.CEPAN);
  })
)

@section Scripts{ 
  <script type="text/javascript">
        function onDataBound() {
            $("#grid").find(".k-grid-Topup").css("background-color", "#4CAF50").css("color", "white");
            $("#grid").find(".k-grid-History").css("background-color", "#2196F3").css("color", "white");
            var today = new Date();
            $("#grid tbody tr").each(function() {
            var endDateText = $(this).find("td:nth-child(3)").text(); 
            var endDate = new Date(endDateText);

            if (endDate < today) {
                $(this).css("background-color", "red");
                $(this).css("color", "white");
            }
        });
        }
      function onTopUp(e) {
          e.preventDefault();
          var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
          var url = '@Url.Action("topup", "consumers")/' + dataItem.CEPAN;
            newTab = window.open(url, '_blank');
        }
         function onPassHistory(e) {
          e.preventDefault();

          var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
              var url = '@Url.Action("passhistory", "consumers")/' + dataItem.CEPAN;
          newTab = window.open(url, '_blank');
        }
  </script>
}
