@model ValueCards.Models.ConsumerTopupModel

<div id="messages" class="k-content"></div>

@(
Html.Kendo().Form<ValueCards.Models.ConsumerTopupModel>()
  .Name("form")
  .HtmlAttributes(new { method = "POST", style = "width: 500px;" })
  .Orientation("horizontal")
  .Items(items =>
  {
      items.AddGroup()
      .Label("Eidt Day Pass")
      .Items(i =>
      {
          i.Add().Field(f => f.Amount).Label("Number of Days");
          i.Add().Field(f => f.EndDate).Label("End Validity").Editor(e =>
       {
         e.DatePicker()
       // .Format("yyyy-MM-dd")
        .ParseFormats("yyyy-MM-dd", "MM/dd/yyyy", "dd/MM/yyyy");
        });
       //   i.Add().EditorTemplate("<input type='hidden' name='EndDate' value='#= EndDate #' />");
        //  i.Add().Field(f => f.CEPAN).Label(" ");//.EditorTemplate("<input name='Id' type='hidden' />");
      });
      items.AddGroup()
      .Label("Customer")
      .Items(i =>
      {
          i.Add().Field(f => f.CEPAN).InputHtmlAttributes(new { disabled = "disabled" });//.EditorTemplate("<input name='EPAN' class='k-textbox' disabled />");
          i.Add().Field(f => f.StartDate).Label("Start Validity").InputHtmlAttributes(new { disabled = "disabled" });//.EditorTemplate("<input name='Start Validity' class='k-textbox' disabled />");
      
     //   i.Add().Field(f => f.Balance).EditorTemplate("<input name='Balance' class='k-textbox' disabled />"); ;
      });

  })
  .Events(events => events.Submit("onSubmit"))
  .Validatable(v =>
  {
    v.ValidateOnBlur(true);
    v.ValidationSummary(vs => vs.Enable(false));
  })
)

@(Html.Kendo().Notification().Name("notification")
  .Animation(animation =>
  {
    animation.Open(open => open.SlideIn(SlideDirection.Down).Duration(AnimationDuration.Normal));
    animation.Close(c => c.Fade(FadeDirection.Out).Duration(AnimationDuration.Slow));
  })
  .AppendTo("#messages")
  //.Position(postion => postion.Top(70))
)

@section Scripts {
  <script type="text/javascript">
    $.fn.serializeObject = function () {
      var o = {};
      this.serializeArray().map(function (x) { o[x.name] = x.value; });
      return o;
    };

    $(function () {
      var amount = $("#Amount").data("kendoNumericTextBox");
      amount.focus();
    });

    function onSubmit(e) {
      e.preventDefault();

      var popupNotification = $("#notification").data("kendoNotification");

      var url = $('#form').attr('action');
      var model = $('#form').serializeObject();
      $.post(url, model, function (data) {
        console.log("succeed");
        popupNotification.show("Request processed, the Day pass has been topped up.", "success");
        var container = $(popupNotification.options.appendTo);
        container.scrollTop(container[0].scrollHeight);

        var form = $("#form").data("kendoForm");
        form.clear();

        $(".k-form-submit").attr("disabled", "disabled");
      })
        .fail(function (e) {
          console.error(e);
          var m = JSON.parse(e.responseText);
          popupNotification.show(m.message, "error");

        })
        .always(function () {
        });

    }
  </script>
}